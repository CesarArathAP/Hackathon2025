<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Catastro AutomÃ¡tico</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
      :root { --brand: #2f9e44; --brand-dark: #1e7a33; --brand-light: #e9f7ef; }
      .text-brand { color: var(--brand); }
      .bg-brand { background-color: var(--brand); }
      .bg-brand-light { background-color: var(--brand-light); }
      .btn-brand { background-color: var(--brand); color: #fff; }
      .btn-brand:hover { background-color: var(--brand-dark); color: #fff; }
      .hero-img { max-height: 360px; object-fit: cover; }
      .feature-icon { font-size: 2rem; color: var(--brand); }
      .step-line { width: 3px; background: var(--brand); min-height: 24px; margin: 0 auto; }
      .testimonial-avatar { width: 80px; height: 80px; }
      .footer { background-color: var(--brand-dark); color: #fff; }
      .nav-link.active { font-weight: 600; }
      .carousel-caption { background-color: rgba(0,0,0,0.5); padding: 1rem; border-radius: 8px; }
      .carousel-control-prev-icon, .carousel-control-next-icon { background-color: rgba(47, 158, 68, 0.8); border-radius: 50%;padding: 1rem; }
      .modal-backdrop.show { opacity: .5; backdrop-filter: blur(2px); }
      /* Estilo adicional para el formulario */
      .form-section-title { border-bottom: 2px solid var(--brand); padding-bottom: 5px; margin-bottom: 1.5rem; }
      .form-check-label { font-weight: 500; }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-white shadow-sm sticky-top">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="/">
          <i class="bi bi-diamond-fill text-brand me-2"></i>
          <span class="fw-semibold">Catastro</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="mainNav">
          <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="/">Inicio</a></li>
            <li class="nav-item"><a class="nav-link" href="/sobrenosotros">Sobre Nosotros</a></li>
            <li class="nav-item"><a class="nav-link" href="/contacto">ContÃ¡ctenos</a></li>
          </ul>
          <a class="btn btn-brand" href="/sobrenosotros" >Cerrar sesiÃ³n</a>
        </div>
      </div>
    </nav>

    <main class="py-5 bg-light">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-10">
            <h1 class="text-center display-5 mb-4 text-brand fw-bold">DiagnÃ³stico Catastral AutomÃ¡tico ðŸ“Š</h1>
            <p class="text-center lead mb-5 text-muted">Responda brevemente el siguiente cuestionario para obtener un anÃ¡lisis instantÃ¡neo del estado de su catastro municipal y recomendaciones personalizadas.</p>

            <form class="p-4 p-md-5 bg-white rounded shadow-lg">
              
              <h3 class="text-brand form-section-title">CartografÃ­a y VerificaciÃ³n de Campo</h3>
              
              <div class="mb-4">
                <label for="cartografiaActualizada" class="form-label fw-semibold">1. Â¿El municipio cuenta con mapas y ortofotos actualizadas de su territorio?</label>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="cartografiaActualizada" id="cartografiaSi" value="si" required>
                  <label class="form-check-label" for="cartografiaSi">SÃ­</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="cartografiaActualizada" id="cartografiaNo" value="no">
                  <label class="form-check-label" for="cartografiaNo">No</label>
                </div>
              </div>

              <div class="mb-4">
                <label for="ultimaActualizacion" class="form-label fw-semibold">2. Â¿CuÃ¡ndo fue la Ãºltima vez que se actualizÃ³ la cartografÃ­a oficial?</label>
                <input type="text" class="form-control" id="ultimaActualizacion" placeholder="Ej. Hace 3 aÃ±os / 2022 / Nunca" required>
              </div>

              <div class="mb-4">
                <label for="inspeccionesCampo" class="form-label fw-semibold">3. Â¿Realizan inspecciones de campo? Si sÃ­, Â¿con quÃ© frecuencia y con quÃ© personal o equipo?</label>
                <textarea class="form-control" id="inspeccionesCampo" rows="3" placeholder="Ej. SÃ­, trimestralmente, con 2 tÃ©cnicos y drones bÃ¡sicos. / No."></textarea>
              </div>

              <div class="mb-4">
                <label for="coincidenciaPadron" class="form-label fw-semibold">4. Â¿Consideran que su padrÃ³n catastral coincide con la cartografÃ­a? Â¿En quÃ© porcentaje estiman esa coincidencia?</label>
                <input type="range" class="form-range" min="0" max="100" step="5" id="coincidenciaPadron" oninput="this.nextElementSibling.value=this.value+'%'" required>
                <output class="d-block text-center mt-2 fw-bold text-brand">50%</output>
              </div>

              <hr class="my-4 text-brand">

              <h3 class="text-brand form-section-title">Sistemas y GestiÃ³n Documental</h3>

              <div class="mb-4">
                <label for="sistemaSuficiente" class="form-label fw-semibold">5. Â¿El sistema de gestiÃ³n catastral que utilizan actualmente es suficiente o buscan una plataforma mÃ¡s eficiente?</label>
                <select class="form-select" id="sistemaSuficiente" required>
                  <option value="" disabled selected>Seleccione una opciÃ³n</option>
                  <option value="suficiente">Es suficiente para nuestras necesidades</option>
                  <option value="ineficiente">Buscamos una plataforma mÃ¡s eficiente</option>
                  <option value="ninguno">No utilizamos un sistema de gestiÃ³n como tal</option>
                </select>
              </div>

              <div class="mb-4">
                <label for="documentacionFormato" class="form-label fw-semibold">6. Â¿La documentaciÃ³n del catastro se encuentra en archivo fÃ­sico, digital o en ambos formatos?</label>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="formatoFisico" value="FÃ­sico" name="formato">
                  <label class="form-check-label" for="formatoFisico">FÃ­sico</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="formatoDigital" value="Digital" name="formato">
                  <label class="form-check-label" for="formatoDigital">Digital</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="formatoAmbos" value="Ambos" name="formato">
                  <label class="form-check-label" for="formatoAmbos">Ambos</label>
                </div>
              </div>

              <div class="mb-4">
                <label for="sigMultifinalitario" class="form-label fw-semibold">7. Â¿Cuentan con un SIG multifinalitario para compartir y consultar la informaciÃ³n catastral en un solo lugar?</label>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="sigMultifinalitario" id="sigSi" value="si" required>
                  <label class="form-check-label" for="sigSi">SÃ­</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="sigMultifinalitario" id="sigNo" value="no">
                  <label class="form-check-label" for="sigNo">No</label>
                </div>
              </div>

              <div class="mb-4">
                <label for="problemasRegistros" class="form-label fw-semibold">8. Â¿Existen problemas de duplicidad, errores o datos incompletos en los registros del catastro?</label>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="problemasRegistros" id="registrosSi" value="si" required>
                  <label class="form-check-label" for="registrosSi">SÃ­, frecuentemente</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="problemasRegistros" id="registrosPocos" value="pocos">
                  <label class="form-check-label" for="registrosPocos">Algunos</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="problemasRegistros" id="registrosNo" value="no">
                  <label class="form-check-label" for="registrosNo">No, son muy limpios</label>
                </div>
              </div>

              <div class="mb-4">
                <label for="principalesProblemas" class="form-label fw-semibold">9. Â¿CuÃ¡les son los principales problemas o limitaciones que enfrentan en la administraciÃ³n de la informaciÃ³n catastral?</label>
                <textarea class="form-control" id="principalesProblemas" rows="3" placeholder="Mencione los desafÃ­os mÃ¡s importantes que enfrentan."></textarea>
              </div>

              <div class="mb-4">
                <label for="tiempoLocalizacion" class="form-label fw-semibold">10. Â¿El personal tarda mucho tiempo en localizar expedientes o documentos cuando se requieren?</label>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="tiempoLocalizacion" id="tiempoSi" value="si" required>
                  <label class="form-check-label" for="tiempoSi">SÃ­, considerablemente</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="tiempoLocalizacion" id="tiempoAceptable" value="aceptable">
                  <label class="form-check-label" for="tiempoAceptable">Un tiempo aceptable</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="tiempoLocalizacion" id="tiempoNo" value="no">
                  <label class="form-check-label" for="tiempoNo">No, la localizaciÃ³n es rÃ¡pida</label>
                </div>
              </div>

              <button type="submit" class="btn btn-brand btn-lg w-100 mt-4">Obtener mi DiagnÃ³stico Catastral AutomÃ¡tico</button>

            </form>

          </div>
        </div>
      </div>
    </main>

    <footer class="footer py-4">
      <div class="container">
        <div class="row align-items-center g-3">
          <div class="col-md-3 d-flex align-items-center">
            <i class="bi bi-diamond-fill me-2"></i>
            <span>Catastro</span>
          </div>
          <div class="col-md-6 text-center">
            <small>Â© 2025 Catastro AutomÃ¡tico â€¢ contacto@catastro.app â€¢ +56 9 1234 5678</small>
          </div>
          <div class="col-md-3 text-md-end text-center">
            <a class="text-white me-2" href="#"><i class="bi bi-twitter-x"></i></a>
            <a class="text-white me-2" href="#"><i class="bi bi-linkedin"></i></a>
            <a class="text-white" href="#"><i class="bi bi-github"></i></a>
          </div>
        </div>
      </div>
    </footer>
    
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
          <div class="modal-body p-4 bg-brand-light rounded">
            <h5 class="mb-3">Iniciar SesiÃ³n</h5>
            <form>
              <div class="mb-3">
                <label for="loginEmail" class="form-label">Correo</label>
                <input type="email" class="form-control" id="loginEmail" placeholder="nombre@ejemplo.com" required>
              </div>
              <div class="mb-3">
                <label for="loginPassword" class="form-label">ContraseÃ±a</label>
                <input type="password" class="form-control" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
              </div>
              <button type="submit" class="btn btn-brand w-100">Iniciar SesiÃ³n</button>
              <div class="text-center mt-2">
                <small>Â¿No tienes cuenta? <a href="#" class="link-success link-register">Registrarse</a></small>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
          <div class="modal-body p-4 bg-brand-light rounded">
            <h5 class="mb-3">Registrarse</h5>
            <div id="regError" class="alert alert-danger d-none" role="alert"></div>
            <form id="regForm">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="regEstado" class="form-label">Estado</label>
                  <select class="form-control" id="regEstado" required>
                    <option value="">Selecciona un estado</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="regMunicipio" class="form-label">Municipio</label>
                  <select class="form-control" id="regMunicipio" required disabled>
                    <option value="">Primero selecciona un estado</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="regNombre" class="form-label">Nombre</label>
                  <input type="text" class="form-control" id="regNombre" placeholder="Tu nombre" required>
                </div>
                <div class="col-md-6">
                  <label for="regTelefono" class="form-label">TelÃ©fono</label>
                  <input type="tel" class="form-control" id="regTelefono" placeholder="+52 55 1234 5678" required>
                </div>
                <div class="col-12">
                  <label for="regCorreo" class="form-label">Correo</label>
                  <input type="email" class="form-control" id="regCorreo" placeholder="nombre@ejemplo.com" required>
                </div>
                <div class="col-12">
                  <label for="regPassword" class="form-label">ContraseÃ±a</label>
                  <input type="password" class="form-control" id="regPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                </div>
              </div>
              <button type="submit" class="btn btn-brand w-100 mt-3">Registrarse</button>
              <div class="text-center mt-2">
                <small>Â¿Ya tienes cuenta? <a href="#" class="link-success link-login-back">Iniciar SesiÃ³n</a></small>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        var params = new URLSearchParams(window.location.search);
        if (params.has('embed')) {
          var navEl = document.querySelector('nav.navbar');
          if (navEl) navEl.remove();
          var embedModals = document.querySelectorAll('#loginModal, #registerModal');
          embedModals.forEach(function (el) { el && el.remove(); });
        }
        var loginModalEl = document.getElementById('loginModal');
        var registerModalEl = document.getElementById('registerModal');
        if (loginModalEl && registerModalEl) {
          var loginModal = bootstrap.Modal.getOrCreateInstance(loginModalEl);
          var registerModal = bootstrap.Modal.getOrCreateInstance(registerModalEl);
          var toRegisterLinks = document.querySelectorAll('.link-register');
          toRegisterLinks.forEach(function (a) {
            a.addEventListener('click', function (e) {
              e.preventDefault();
              loginModal.hide();
              registerModal.show();
            });
          });
          var toLoginLinks = document.querySelectorAll('.link-login-back');
          toLoginLinks.forEach(function (a) {
            a.addEventListener('click', function (e) {
              e.preventDefault();
              registerModal.hide();
              loginModal.show();
            });
          });
        }

        // Cargar estados al abrir el modal de registro
        if (registerModalEl) {
          registerModalEl.addEventListener('show.bs.modal', async function() {
            await cargarEstadosFormulario();
          });
        }

        // FunciÃ³n para cargar estados
        async function cargarEstadosFormulario() {
          try {
            var response = await fetch('/api/estados');
            var estados = await response.json();
            var selectEstado = document.getElementById('regEstado');
            if (selectEstado) {
              selectEstado.innerHTML = '<option value="">Selecciona un estado</option>';
              estados.forEach(function(estado) {
                var option = document.createElement('option');
                option.value = estado.id_estado;
                option.textContent = estado.nombre_estado;
                selectEstado.appendChild(option);
              });
            }
          } catch (error) {
            console.error('Error al cargar estados:', error);
          }
        }

        // Cargar municipios cuando se seleccione un estado
        var selectEstado = document.getElementById('regEstado');
        var selectMunicipio = document.getElementById('regMunicipio');
        if (selectEstado && selectMunicipio) {
          selectEstado.addEventListener('change', async function() {
            var estadoId = this.value;
            selectMunicipio.disabled = true;
            selectMunicipio.innerHTML = '<option value="">Cargando municipios...</option>';
            
            if (estadoId) {
              try {
                var response = await fetch('/api/municipios/estado/' + estadoId);
                var municipios = await response.json();
                selectMunicipio.innerHTML = '<option value="">Selecciona un municipio</option>';
                municipios.forEach(function(municipio) {
                  var option = document.createElement('option');
                  option.value = municipio.id;
                  option.textContent = municipio.nombre;
                  selectMunicipio.appendChild(option);
                });
                selectMunicipio.disabled = false;
              } catch (error) {
                console.error('Error al cargar municipios:', error);
                selectMunicipio.innerHTML = '<option value="">Error al cargar municipios</option>';
              }
            } else {
              selectMunicipio.innerHTML = '<option value="">Primero selecciona un estado</option>';
            }
          });
        }

        // Manejar formulario de registro
        var regForm = document.getElementById('regForm');
        var regError = document.getElementById('regError');
        if (regForm) {
          regForm.addEventListener('submit', async function (e) {
            e.preventDefault();
            if (regError) regError.classList.add('d-none');
            
            var id_municipio = document.getElementById('regMunicipio').value;
            var nombre = document.getElementById('regNombre').value;
            var telefono = document.getElementById('regTelefono').value;
            var correo = document.getElementById('regCorreo').value;
            var password = document.getElementById('regPassword').value;

            if (!id_municipio) {
              if (regError) {
                regError.textContent = 'Por favor selecciona un estado y municipio';
                regError.classList.remove('d-none');
              }
              return;
            }

            try {
              var response = await fetch('/api/auth/registro', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: correo, password, nombre, telefono, id_municipio })
              });

              var data = await response.json();

              if (response.ok && data.success && data.usuario) {
                // Guardar informaciÃ³n del usuario en localStorage
                localStorage.setItem('usuario', JSON.stringify(data.usuario));
                localStorage.setItem('isLoggedIn', 'true');
                
                // Cerrar modal y recargar pÃ¡gina
                if (registerModalEl) {
                  var registerModal = bootstrap.Modal.getInstance(registerModalEl);
                  if (registerModal) registerModal.hide();
                }
                window.location.reload();
              } else {
                if (regError) {
                  regError.textContent = data.error || 'Error al registrar usuario';
                  regError.classList.remove('d-none');
                }
              }
            } catch (error) {
              if (regError) {
                regError.textContent = 'Error de conexiÃ³n. Por favor, intenta de nuevo.';
                regError.classList.remove('d-none');
              }
              console.error('Error:', error);
            }
          });
        }
        var coincidenciaPadron = document.getElementById('coincidenciaPadron');
        if (coincidenciaPadron) {
            coincidenciaPadron.value = 50;
        }
      });
    </script>
 Â </body>
</html>